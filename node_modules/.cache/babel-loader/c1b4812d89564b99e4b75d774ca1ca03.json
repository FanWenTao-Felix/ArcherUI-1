{"remainingRequest":"E:\\blade\\blade\\ArcherUI\\node_modules\\babel-loader\\lib\\index.js!E:\\blade\\blade\\ArcherUI\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\blade\\blade\\ArcherUI\\src\\store\\modules\\user.js","dependencies":[{"path":"E:\\blade\\blade\\ArcherUI\\src\\store\\modules\\user.js","mtime":1592365960917},{"path":"E:\\blade\\blade\\ArcherUI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\blade\\blade\\ArcherUI\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\blade\\blade\\ArcherUI\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _typeof from \"E:/blade/blade/ArcherUI/node_modules/@babel/runtime/helpers/esm/typeof\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.for-each\";\nimport { setToken, removeToken } from '@/util/auth';\nimport { setStore, getStore } from '@/util/store';\nimport { isURL, validatenull } from '@/util/validate';\nimport { deepClone } from '@/util/util';\nimport webiste from '@/config/website';\nimport { loginByUsername, getUserInfo, getMenu, getTopMenu, logout, refeshToken, getButtons } from '@/api/user';\n\nfunction addPath(ele, first) {\n  var menu = webiste.menu;\n  var propsConfig = menu.props;\n  var propsDefault = {\n    label: propsConfig.label || 'name',\n    path: propsConfig.path || 'path',\n    icon: propsConfig.icon || 'icon',\n    children: propsConfig.children || 'children'\n  };\n  var icon = ele[propsDefault.icon];\n  ele[propsDefault.icon] = validatenull(icon) ? menu.iconDefault : icon;\n  var isChild = ele[propsDefault.children] && ele[propsDefault.children].length !== 0;\n  if (!isChild) ele[propsDefault.children] = [];\n\n  if (!isChild && first && !isURL(ele[propsDefault.path])) {\n    ele[propsDefault.path] = ele[propsDefault.path] + '/index';\n  } else {\n    ele[propsDefault.children].forEach(function (child) {\n      addPath(child);\n    });\n  }\n}\n\nvar user = {\n  state: {\n    userInfo: getStore({\n      name: 'userInfo'\n    }) || [],\n    permission: getStore({\n      name: 'permission'\n    }) || {},\n    roles: [],\n    menu: getStore({\n      name: 'menu'\n    }) || [],\n    menuAll: [],\n    token: getStore({\n      name: 'token'\n    }) || ''\n  },\n  actions: {\n    //根据用户名登录\n    LoginByUsername: function LoginByUsername(_ref, userInfo) {\n      var commit = _ref.commit;\n      return new Promise(function (resolve, reject) {\n        loginByUsername(userInfo.tenantId, userInfo.username, userInfo.password, userInfo.type).then(function (res) {\n          var data = res.data.data;\n          commit('SET_TOKEN', data.accessToken);\n          commit('SET_USERIFNO', data);\n          commit('DEL_ALL_TAG');\n          commit('CLEAR_LOCK');\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    GetButtons: function GetButtons(_ref2) {\n      var commit = _ref2.commit;\n      return new Promise(function (resolve) {\n        getButtons().then(function (res) {\n          var data = res.data.data;\n          commit('SET_PERMISSION', data);\n          resolve();\n        });\n      });\n    },\n    //根据手机号登录\n    LoginByPhone: function LoginByPhone(_ref3, userInfo) {\n      var commit = _ref3.commit;\n      return new Promise(function (resolve) {\n        loginByUsername(userInfo.phone, userInfo.code).then(function (res) {\n          var data = res.data.data;\n          commit('SET_TOKEN', data);\n          commit('DEL_ALL_TAG');\n          commit('CLEAR_LOCK');\n          resolve();\n        });\n      });\n    },\n    GetUserInfo: function GetUserInfo(_ref4) {\n      var commit = _ref4.commit;\n      return new Promise(function (resolve, reject) {\n        getUserInfo().then(function (res) {\n          var data = res.data.data;\n          commit('SET_ROLES', data.roles);\n          resolve(data);\n        }).catch(function (err) {\n          reject(err);\n        });\n      });\n    },\n    //刷新token\n    RefeshToken: function RefeshToken(_ref5) {\n      var state = _ref5.state,\n          commit = _ref5.commit;\n      return new Promise(function (resolve, reject) {\n        refeshToken(state.refeshToken).then(function (res) {\n          var data = res.data.data;\n          commit('SET_TOKEN', data);\n          resolve(data);\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登出\n    LogOut: function LogOut(_ref6) {\n      var commit = _ref6.commit;\n      return new Promise(function (resolve, reject) {\n        logout().then(function () {\n          commit('SET_TOKEN', '');\n          commit('SET_MENU', []);\n          commit('SET_ROLES', []);\n          commit('DEL_ALL_TAG');\n          commit('CLEAR_LOCK');\n          removeToken();\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    //注销session\n    FedLogOut: function FedLogOut(_ref7) {\n      var commit = _ref7.commit;\n      return new Promise(function (resolve) {\n        commit('SET_TOKEN', '');\n        commit('SET_MENU', []);\n        commit('SET_ROLES', []);\n        commit('DEL_ALL_TAG');\n        commit('CLEAR_LOCK');\n        removeToken();\n        resolve();\n      });\n    },\n    GetTopMenu: function GetTopMenu() {\n      return new Promise(function (resolve) {\n        getTopMenu().then(function (res) {\n          var data = res.data.data || [];\n          resolve(data);\n        });\n      });\n    },\n    //获取系统菜单\n    GetMenu: function GetMenu(_ref8, parentId) {\n      var commit = _ref8.commit,\n          dispatch = _ref8.dispatch;\n      return new Promise(function (resolve) {\n        getMenu(parentId).then(function (res) {\n          var data = res.data.data;\n          var menu = deepClone(data);\n          menu.forEach(function (ele) {\n            addPath(ele, true);\n          });\n          commit('SET_MENU', menu);\n          dispatch('GetButtons');\n          resolve(menu);\n        });\n      });\n    }\n  },\n  mutations: {\n    SET_TOKEN: function SET_TOKEN(state, token) {\n      setToken(token);\n      state.token = token;\n      setStore({\n        name: 'token',\n        content: state.token,\n        type: 'session'\n      });\n    },\n    SET_USERIFNO: function SET_USERIFNO(state, userInfo) {\n      state.userInfo = userInfo;\n      setStore({\n        name: 'userInfo',\n        content: state.userInfo\n      });\n    },\n    SET_MENU: function SET_MENU(state, menu) {\n      state.menu = menu;\n      setStore({\n        name: 'menu',\n        content: state.menu,\n        type: 'session'\n      });\n    },\n    SET_MENU_ALL: function SET_MENU_ALL(state, menuAll) {\n      state.menuAll = menuAll;\n    },\n    SET_ROLES: function SET_ROLES(state, roles) {\n      state.roles = roles;\n    },\n    SET_PERMISSION: function SET_PERMISSION(state, permission) {\n      var result = [];\n\n      function getCode(list) {\n        list.forEach(function (ele) {\n          if (_typeof(ele) === 'object') {\n            var chiildren = ele.children;\n            var code = ele.code;\n\n            if (chiildren) {\n              getCode(chiildren);\n            } else {\n              result.push(code);\n            }\n          }\n        });\n      }\n\n      getCode(permission);\n      state.permission = {};\n      result.forEach(function (ele) {\n        state.permission[ele] = true;\n      });\n      setStore({\n        name: 'permission',\n        content: state.permission,\n        type: 'session'\n      });\n    }\n  }\n};\nexport default user;",{"version":3,"sources":["E:/blade/blade/ArcherUI/src/store/modules/user.js"],"names":["setToken","removeToken","setStore","getStore","isURL","validatenull","deepClone","webiste","loginByUsername","getUserInfo","getMenu","getTopMenu","logout","refeshToken","getButtons","addPath","ele","first","menu","propsConfig","props","propsDefault","label","path","icon","children","iconDefault","isChild","length","forEach","child","user","state","userInfo","name","permission","roles","menuAll","token","actions","LoginByUsername","commit","Promise","resolve","reject","tenantId","username","password","type","then","res","data","accessToken","catch","error","GetButtons","LoginByPhone","phone","code","GetUserInfo","err","RefeshToken","LogOut","FedLogOut","GetTopMenu","GetMenu","parentId","dispatch","mutations","SET_TOKEN","content","SET_USERIFNO","SET_MENU","SET_MENU_ALL","SET_ROLES","SET_PERMISSION","result","getCode","list","chiildren","push"],"mappings":"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","sourcesContent":["import { setToken, removeToken } from '@/util/auth'\r\nimport { setStore, getStore } from '@/util/store'\r\nimport { isURL, validatenull } from '@/util/validate'\r\nimport { deepClone } from '@/util/util'\r\nimport webiste from '@/config/website'\r\nimport { loginByUsername, getUserInfo, getMenu, getTopMenu, logout, refeshToken, getButtons } from '@/api/user'\r\n\r\n\r\nfunction addPath(ele, first) {\r\n    const menu = webiste.menu;\r\n    const propsConfig = menu.props;\r\n    const propsDefault = {\r\n        label: propsConfig.label || 'name',\r\n        path: propsConfig.path || 'path',\r\n        icon: propsConfig.icon || 'icon',\r\n        children: propsConfig.children || 'children'\r\n    }\r\n    const icon = ele[propsDefault.icon];\r\n    ele[propsDefault.icon] = validatenull(icon) ? menu.iconDefault : icon;\r\n    const isChild = ele[propsDefault.children] && ele[propsDefault.children].length !== 0;\r\n    if (!isChild) ele[propsDefault.children] = [];\r\n    if (!isChild && first && !isURL(ele[propsDefault.path])) {\r\n        ele[propsDefault.path] = ele[propsDefault.path] + '/index'\r\n    } else {\r\n        ele[propsDefault.children].forEach(child => {\r\n            addPath(child);\r\n        })\r\n    }\r\n\r\n}\r\nconst user = {\r\n    state: {\r\n        userInfo: getStore({ name: 'userInfo' }) || [],\r\n        permission: getStore({ name: 'permission' }) || {},\r\n        roles: [],\r\n        menu: getStore({ name: 'menu' }) || [],\r\n        menuAll: [],\r\n        token: getStore({ name: 'token' }) || '',\r\n    },\r\n    actions: {\r\n        //根据用户名登录\r\n        LoginByUsername({ commit }, userInfo) {\r\n            return new Promise((resolve, reject) => {\r\n                loginByUsername(userInfo.tenantId, userInfo.username, userInfo.password, userInfo.type).then(res => {\r\n                    const data = res.data.data;\r\n                    commit('SET_TOKEN', data.accessToken);\r\n                    commit('SET_USERIFNO', data);\r\n                    commit('DEL_ALL_TAG');\r\n                    commit('CLEAR_LOCK');\r\n                    resolve();\r\n                }).catch(error => {\r\n                  reject(error);\r\n                })\r\n            })\r\n        },\r\n        GetButtons({ commit }) {\r\n            return new Promise((resolve) => {\r\n                getButtons().then(res => {\r\n                    const data = res.data.data;\r\n                    commit('SET_PERMISSION', data);\r\n                    resolve();\r\n                })\r\n            })\r\n        },\r\n        //根据手机号登录\r\n        LoginByPhone({ commit }, userInfo) {\r\n            return new Promise((resolve) => {\r\n                loginByUsername(userInfo.phone, userInfo.code).then(res => {\r\n                    const data = res.data.data;\r\n                    commit('SET_TOKEN', data);\r\n                    commit('DEL_ALL_TAG');\r\n                    commit('CLEAR_LOCK');\r\n                    resolve();\r\n                })\r\n            })\r\n        },\r\n        GetUserInfo({ commit }) {\r\n            return new Promise((resolve, reject) => {\r\n                getUserInfo().then((res) => {\r\n                    const data = res.data.data;\r\n                    commit('SET_ROLES', data.roles);\r\n                    resolve(data);\r\n                }).catch(err => {\r\n                    reject(err);\r\n                })\r\n            })\r\n        },\r\n        //刷新token\r\n        RefeshToken({ state, commit }) {\r\n            return new Promise((resolve, reject) => {\r\n                refeshToken(state.refeshToken).then(res => {\r\n                    const data = res.data.data;\r\n                    commit('SET_TOKEN', data);\r\n                    resolve(data);\r\n                }).catch(error => {\r\n                    reject(error)\r\n                })\r\n            })\r\n        },\r\n        // 登出\r\n        LogOut({ commit }) {\r\n            return new Promise((resolve, reject) => {\r\n                logout().then(() => {\r\n                    commit('SET_TOKEN', '')\r\n                    commit('SET_MENU', [])\r\n                    commit('SET_ROLES', [])\r\n                    commit('DEL_ALL_TAG');\r\n                    commit('CLEAR_LOCK');\r\n                    removeToken()\r\n                    resolve()\r\n                }).catch(error => {\r\n                    reject(error)\r\n                })\r\n            })\r\n        },\r\n        //注销session\r\n        FedLogOut({ commit }) {\r\n            return new Promise(resolve => {\r\n                commit('SET_TOKEN', '')\r\n                commit('SET_MENU', [])\r\n                commit('SET_ROLES', [])\r\n                commit('DEL_ALL_TAG');\r\n                commit('CLEAR_LOCK');\r\n                removeToken()\r\n                resolve()\r\n            })\r\n        },\r\n        GetTopMenu() {\r\n            return new Promise(resolve => {\r\n                getTopMenu().then((res) => {\r\n                    const data = res.data.data || []\r\n                    resolve(data)\r\n                })\r\n            })\r\n        },\r\n        //获取系统菜单\r\n        GetMenu({ commit, dispatch }, parentId) {\r\n            return new Promise(resolve => {\r\n                getMenu(parentId).then((res) => {\r\n                    const data = res.data.data\r\n                    let menu = deepClone(data);\r\n                    menu.forEach(ele => {\r\n                        addPath(ele, true);\r\n                    })\r\n                    commit('SET_MENU', menu)\r\n                    dispatch('GetButtons');\r\n                    resolve(menu)\r\n                })\r\n            })\r\n        },\r\n    },\r\n    mutations: {\r\n        SET_TOKEN: (state, token) => {\r\n            setToken(token)\r\n            state.token = token;\r\n            setStore({ name: 'token', content: state.token, type: 'session' })\r\n        },\r\n        SET_USERIFNO: (state, userInfo) => {\r\n            state.userInfo = userInfo;\r\n            setStore({ name: 'userInfo', content: state.userInfo })\r\n        },\r\n        SET_MENU: (state, menu) => {\r\n            state.menu = menu\r\n            setStore({ name: 'menu', content: state.menu, type: 'session' })\r\n        },\r\n        SET_MENU_ALL: (state, menuAll) => {\r\n            state.menuAll = menuAll;\r\n        },\r\n        SET_ROLES: (state, roles) => {\r\n            state.roles = roles;\r\n        },\r\n        SET_PERMISSION: (state, permission) => {\r\n            let result = [];\r\n            function getCode(list) {\r\n                list.forEach(ele => {\r\n                    if (typeof (ele) === 'object') {\r\n                        const chiildren = ele.children;\r\n                        const code = ele.code;\r\n                        if (chiildren) {\r\n                            getCode(chiildren)\r\n                        } else {\r\n                            result.push(code);\r\n                        }\r\n                    }\r\n\r\n                })\r\n            }\r\n            getCode(permission);\r\n            state.permission = {};\r\n            result.forEach(ele => {\r\n                state.permission[ele] = true;\r\n            });\r\n            setStore({ name: 'permission', content: state.permission, type: 'session' })\r\n        }\r\n    }\r\n\r\n}\r\nexport default user\r\n"]}]}